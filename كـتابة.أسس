اشمل "دمـغة.أسس"؛
اشمل "مـتم/نـص.أسس"؛
اشمل "مـتم/مـصفوفة.أسس"؛

صنف كـتابة {
    استخدم مـتم؛

    عرف مـحاذاة: {
        عرف _يمين_: 1؛
        عرف _يسار_: 2؛
        عرف _وسط_: 0؛
    }

    عرف رسام: مؤشر[طـوب.رسـام]؛
    عرف خط: مؤشر[طـوب.كـتابة.خـط]؛
    عرف لون: طـوب.لـون؛
    عرف عربي: صحيح = 0؛
    عرف محاذاة: صحيح = مـحاذاة._يسار_؛
    عرف تباعد_الأسطر: صحيح = 0؛

    عرف نص: نـص؛
    عرف سطور: مـصفوفة[دمـغة]؛
    عرف س: صحيح؛
    عرف ص: صحيح؛

    عملية هذا.تهيئة (ر: مؤشر[طـوب.رسـام]، خ: مؤشر[طـوب.كـتابة.خـط]، ل: طـوب.لـون، س: صحيح، ص: صحيح) {
        هذا.حرر_السطور()؛
        هذا.نص = ""؛
        هذا.رسام = ر؛
        هذا.خط = خ؛
        هذا.لون = ل؛
        هذا.س = س؛
        هذا.ص = ص؛
    }

    عملية هذا.عين_النص (ن: مـؤشر_محارف) {
        إذا هذا.نص == ن ارجع؛
        هذا.نص = ن؛
        هذا.هيئ_السطور()؛
    }

    عملية هذا.عين_النص(ر: صحيح) {
        عرف صوان: مصفوفة[مـحرف، 50]؛
        مـتم.نـص.عين(صوان~مؤشر، "%d"، ر)؛
        هذا.عين_النص(صوان~مؤشر)؛
    }

    عملية هذا.هيئ_السطور() {
        هذا.حرر_السطور()؛
        عرف نصوص: مـصفوفة[نـص] = هذا.نص.قطع("\ج")؛
        عرف م: صحيح؛
        لكل م = 0، م < نصوص.getLength()، ++م {
            عرف نقش: مؤشر[طـوب.نـقش] = طـوب.كـتابة.أنشئ_نقش_كتابة(نصوص(م).صوان, هذا.لون~مؤشر, هذا.خط, هذا.عربي, هذا.رسام)؛
            عرف دمغة: دمـغة؛
            دمغة.هيئ(هذا.رسام، نقش)؛
            هذا.سطور.أضف(دمغة)؛
        }
    }

    عملية هذا.حرر_السطور() {
        عرف م: صحيح؛
        لكل م = 0، م < هذا.سطور.هات_الطول()، ++م هذا.سطور(م).حرر()؛
        هذا.سطور.فرغ()؛
    }

    عملية هذا.هات_الأبعاد (): طـوب.مـستطيل {
        عرف مستطيل: طـوب.مـستطيل؛
        مستطيل.س = مستطيل.ص = 0؛
        مستطيل.ط = مستطيل.ع = 0؛
        عرف م: صحيح؛
        لكل م = 0، م < هذا.سطور.هات_الطول()، ++م {
            مستطيل.ط += هذا.سطور(م).طول؛
            إذا م != 0 مستطيل.ط += هذا.تباعد_الأسطر؛
            إذا مستطيل.ع < هذا.سطور(م).عرض { مستطيل.ع = هذا.سطور(م).عرض }
        }
        أرجع مستطيل؛
    }

    عملية هذا.اطمغ() {
        هذا.اطمغ(هذا.س، هذا.ص)؛
    }

    عملية هذا.اطمغ(س: صحيح، ص: صحيح) {
        عرف م: صحيح؛
        لكل م = 0، م < هذا.سطور.getLength()، ++م {
            إذا هذا.محاذاة == مـحاذاة._يمين_ {
                هذا.سطور(م).اطمغ(س - هذا.سطور(م).عرض، ص)؛
            } وإلا إذا هذا.محاذاة == مـحاذاة._يسار_ {
                هذا.سطور(م).اطمغ(س، ص)؛
            } وإلا {
                هذا.سطور(م).اطمغ(س - هذا.سطور(م).عرض ÷ 2، ص)؛
            }
            ص += هذا.سطور(م).طول + هذا.تباعد_الأسطر؛
        }
    }
}

